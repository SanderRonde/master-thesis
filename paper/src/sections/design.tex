\chapter{Study Design}\label{sec:design}

\section{Metric definitions}
In order to evaluate the effectiveness of converting an existing set of Angular components to a Web Component UI library, we need to define some metrics. We will be measuring two aspects of this process. The first is measuring the effectiveness of the resulting CC UI library. In order to do this, we will compare the components in the CC UI library to the Angular components they originate from, as well as to various different UI libraries. We will make this comparison using various metrics at both component granularity and at UI library granularity. We have chosen the following metrics: structural complexity (SC), cyclomatic complexity (CC), lines of code (LOC), maintainability (MA), size (SI), load time (LT), number of components in the UI library (NOC), first paint (FP), first contentful paint (FCP), and render time (RT).  A brief description of these metrics can be seen in Table~\ref{tab:design:metrics}. A detailed explanation of these metrics follows.


\begin{table}[h]
	\tiny
	\begin{tabularx}{\textwidth}{l|l|l|X}
		\toprule
		\textbf{ID} & \textbf{Metric}        & \textbf{Granularity}             & \textbf{Description}                                                                                                              \\ \midrule
		SC          & Structural complexity  & Component                        & The number of import statements for a component. Collected for a source file and all of its dependencies for up to two iterations \\ \hline
		CC          & Cyclomatic complexity  & Component                        & A quantitative measure of the number of linearly independent paths through a program's~\cite{1702388}                             \\ \hline
		LOC         & Lines of code          & Component                        & The number of lines of code in a given component's source file                                                                    \\ \hline
		MA          & Maintainability        & Component                        & A derivative based on complexity, lines of code and Halstead volume~\cite{halstead1977elements}                                   \\ \hline
		RT          & Render Time            & Component                        & The render time of a given component                                                                                              \\ \hline
		SI          & Size                   & UI Library                       & The file size of the bundled up library                                                                                           \\ \hline
		LT          & Load Time              & UI Library                       & Parsing and running time of the bundled up library in the browser (without download time)                                         \\ \hline
		NOC         & Number of Components   & UI Library                       & The number of components in a UI library                                                                                          \\ \hline
		FC          & First Paint            & UI Library (cow-components only) & First paint event of the browser                                                                                                  \\ \hline
		FCP         & First Contentful Paint & UI Library (cow-components only) & First paint event of the browser that includes content for the user  (text, images, etc.)                                         \\
	\end{tabularx}
	\caption{Metrics used in this study}
	\label{tab:design:metrics}
\end{table}

\subsection{Source code metrics}
The first set of metrics, namely structural complexity, cyclomatic complexity, lines of code, and maintainability are metrics that are recommended by Martinez-Ortiz \etal{}~\cite{martinez-ortiz2016quality}. In this paper, the authors evaluate the ability of various metrics to indicate the quality of Web Components. As such, we will be using these metrics to compare the quality of our Web Components to other Web Components. We'll be following almost all recommendations of the paper, including collecting the structural complexity up to a depth of two. Note that we do things slightly differently from the paper. We also keep track of the lines of code metric, which the authors do not. We will not be using this to compare the quality of Web Components, but will instead be using it to get a rough overview of the complexity of various UI libraries. Note that we are also not using all metrics recommended by the authors. The metrics we are not using are the completeness (i.e.~how complete the information displayed to the user is) and consistency(i.e.~how long it takes for data to update across different replicas) metrics. We are not using completeness because it does not apply at the level at which the CC UI library operates. All of our components are 100\% complete, as well as the components of the UI libraries we will be comparing the CC UI library to. As such, it does not make for a very interesting metric. This metric is very effective when more complex components such as entire pages are concerned, but that is not the case here. We will also not be using the consistency metric. The reason for this is fairly simple, namely that we don't have any components with the ability to update across different replicas. The same goes for the UI libraries we will be comparing it with.

\subsection{Size}
The size metric metric aims to measure the theoretical impact of loading the UI library over the network. We will be measuring this at UI library level granularity since the contributions of individual components are very hard to measure. This should serve as a good indication of the relative network loading time of UI libraries without actually introducing the variable of network speed. In order to differentiate between a relatively large library and a library that has a lot of components, we also keep track of the number of components metric.

\subsection{Load Time}
The load time metric aims to provide a measure of the real impact of a UI library on the page by measuring the real-world load time. Note that we only measure the parsing time and running time of the JavaScript bundle. We explicitly exclude the download time from this metric since this is already captured in SI\@.

\subsection{First Paint, First Contentful Paint}
The first paint metric along with the FCP metric will be measured on just the cow-component UI libraries. We will be using these metrics to evaluate how the paint time of the UI libraries has changed after its conversion to Web Components and its later conversion to JS framework wrappers.

\subsection{Render Time}
Finally, the render time metric aims to capture the duration of the render cycle. We will define this render time as the time between setting the component's visibility to true and the browser being done with the rendering process This will likely be the most important metric for this study. If the render time of components in the CC UI library is significantly higher than components in other UI libraries or the Angular components they originate from, the performance impact of converting Angular components to Web Components will be too big. If it is slightly higher, the same or lower, we can conclude that the performance impact is minimal.

\section{Metric targets}
In order to get a sense of the state of the CC UI library, we will need to compare it to other UI libraries. To do so, we have gathered a list of various UI libraries targeting the most popular JS frameworks. These most popular frameworks are React, Angular, Vue and Svelte~\footurl{https://2020.stateofjs.com/en-US/technologies/front-end-frameworks/}. This way we are able to compare the wrapper targeting a specific JS framework with UI libraries that also target that JS framework, allowing us to observe the influence of the framework itself on the various metrics. These UI libraries were gathered by searching for the terms ``Design Library'', ``UI Library'', ``javascript UI Library'', ``Svelte UI library'', ``React UI Library'', ``Vue UI Library'', ``Angular UI Library'', and ``Web Component UI Library'' on Google. We then added any UI library to the list that we came across, either by finding it as a direct result, or it being mentioned in a blog post or article. A list of the UI libraries we found and the number of stars on their github page can be found in Table~\ref{tab:design:ui-libraries}. While this is not a full list of all UI libraries, we feel like it is an accurate representation of the most popular UI libraries because of the fact that Google Search tends to return the most popular results in a given search. In order to get a fairly accurate representation of libraries using each JS framework, we selected the three UI libraries with the most github stars per JS framework. The list of included UI libraries can also be seen in Table~\ref{tab:design:ui-libraries}. In addition to comparing the CC UI library against other UI libraries, we will also be comparing it against the Angular components they originate from. We do this by applying our metrics to the 30MHz dashboard and the relevant components within it.

Since the components included in the selected UI libraries vary greatly, we can not do a proper comparison between individual components of the UI library. For example a button component can not be compared with a date picker component, since date pickers tend to be a lot more complex. As such, higher rendering times can not be attributed to the UI library running it, but to the component itself. In order to be able to compare every UI library, we have selected a set of basic components that are available in every UI library. These are the Button, Input, and Switch (or Checkbox). Since every UI library contains all of these, we can compare the metrics for a single component across all UI libraries. We will only be applying the various metrics to these three components in each UI library. We will also be including a stripped down version of the CC UI library in the set of UI libraries we gather metrics of. This version will only contain the three components mentioned above, and will allow for a fair comparison with other UI libraries. The reason for this will be further explained in Section~\ref{sec:experimental-setup:size}.

\begin{table*}[t]
	\begin{tabularx}{\textwidth}{p{0.1\textwidth} |p{0.1\textwidth} | p{0.1\textwidth} | p{0.1\textwidth} | p{0.1\textwidth} |p{0.5\textwidth}  }
		\toprule
		\textbf{UI Library}     & \textbf{Github Stars}   & \textbf{JS Framework} & \textbf{Included} & \textbf{Version} & \textbf{Website}                                                                 \\ \midrule
		Svelte Material UI      & 1.6k                    & Svelte                & Yes               & 2.0.0            & \url{https://sveltematerialui.com/}                                              \\ \hline
		Smelte                  & 889                     & Svelte                & Yes               & 1.1.2            & \url{https://smeltejs.com/}                                                      \\ \hline
		Svelte-MUI              & 237                     & Svelte                & Yes               & 0.0.3-7          & \url{https://svelte-mui.ibbf.ru/}                                                \\ \hline
		Svelteit                & 51                      & Svelte                & No                & -                & \url{https://docs.svelteit.dev/}                                                 \\ \hline
		Material UI             & 67.1k                   & React                 & Yes               & 5.0.0-alpha.28   & \url{https://material-ui.com/}                                                   \\ \hline
		React Bootstrap         & 19.2k                   & React                 & Yes               & 1.5.2            & \url{https://react-bootstrap.github.io/}                                         \\ \hline
		React Semantic UI       & 12.2k                   & React                 & Yes               & 2.0.3            & \url{https://react.semantic-ui.com/}                                             \\ \hline
		Evergreen               & 10.6k                   & React                 & No                & -                & \url{https://evergreen.segment.com/}                                             \\ \hline
		Rebass                  & 7.2k                    & React                 & No                & -                & \url{https://rebassjs.org/}                                                      \\ \hline
		Grommet                 & 7.1k                    & React                 & No                & -                & \url{https://v2.grommet.io/}                                                     \\ \hline
		Baseweb                 & 6.2k                    & React                 & No                & -                & \url{https://baseweb.design/}                                                    \\ \hline
		Ant Design              & 5.3k                    & React                 & No                & -                & \url{https://ant.design/}                                                        \\ \hline
		Elemental UI            & 4.3k                    & React                 & No                & -                & \url{http://elemental-ui.com/home }                                              \\ \hline
		Zendesk Garden          & 858                     & React                 & No                & -                & \url{https://garden.zendesk.com/}                                                \\ \hline
		Shards React            & 649                     & React                 & No                & -                & \url{https://designrevision.com/docs/shards-react/getting-started }              \\ \hline
		Angular Material        & 21.3k                   & Angular               & Yes               & 12.0.0-next.5    & \url{https://material.angular.io/}                                               \\ \hline
		NG-Bootstrap            & 7.7k                    & Angular               & Yes               & 9.1.0            & \url{https://ng-bootstrap.github.io/\#/home }                                    \\ \hline
		NGX-Bootstrap           & 5.3k                    & Angular               & Yes               & 7.0.0-rc.0       & \url{https://valor-softw2are.com/ngx-bootstrap/\#/ }                             \\ \hline
		NG-Lightning            & 886                     & Angular               & No                & -                & \url{https://ng-lightning.github.io/ng-lightning/\#/ }                           \\ \hline
		Alyle                   & 236                     & Angular               & No                & -                & \url{https://alyle.io/}                                                          \\ \hline
		Blox Material           & 143                     & Angular               & No                & -                & \url{https://material.src.zone/}                                                 \\ \hline
		Mosaic                  & 117                     & Angular               & No                & -                & \url{https://mosaic.ptsecurity.com/button/overview }                             \\ \hline
		Element                 & 49.8k                   & Vue                   & Yes               & 1.0.2-beta.40    & \url{https://element-plus.org/\#/en-US}                                          \\ \hline
		Vuetify                 & 30.2k                   & Vue                   & Yes               & 2.4.9            & \url{https://vuetifyjs.com/en/}                                                  \\ \hline
		Quasar                  & 18.3k                   & Vue                   & Yes               & 1.15.10          & \url{https://quasar.dev/ }                                                       \\ \hline
		Ant Design Vue          & 14.1k                   & Vue                   & No                & -                & \url{https://2x.antdv.com/docs/vue/introduce }                                   \\ \hline
		Bootstrap Vue           & 13.1k                   & Vue                   & No                & -                & \url{https://bootstrap-vue.org/ }                                                \\ \hline
		Vue-material            & 9.3k                    & Vue                   & No                & -                & \url{https://vuematerial.io/ }                                                   \\ \hline
		Buefy                   & 8.6k                    & Vue                   & No                & -                & \url{https://buefy.org/ }                                                        \\ \hline
		Vuesax                  & 5k                      & Vue                   & No                & -                & \url{https://vuesax.com/ }                                                       \\ \hline
		Chakra                  & 1.1                     & Vue                   & No                & -                & \url{https://vue.chakra-ui.com/ }                                                \\ \hline
		Fish UI                 & 867                     & Vue                   & No                & -                & \url{https://myliang.github.io/fish-ui/ }                                        \\ \hline
		Wired Elements          & 8.5k                    & Web Components        & Yes               & 1.0.0            & \url{https://wiredjs.com/}                                                       \\ \hline
		Clarity Design          & 6.2k                    & Web Components        & Yes               & 5.1.0            & \url{https://clarity.design/}                                                    \\ \hline
		Fast                    & 5.6k                    & Web Components        & Yes               & 1.8.0            & \url{https://www.fast.design/}                                                   \\ \hline
		Material Web Components & 2.5k                    & Web Components        & No                & -                & \url{https://github.com/material-components/material-components-web-components } \\ \hline
		UI5                     & 887                     & Web Components        & No                & -                & \url{https://sap.github.io/ui5-webcomponents/}                                   \\ \hline
		Vaadin                  & 17                      & Web Components        & No                & -                & \url{https://vaadin.com/}                                                        \\ \hline
		Onsen                   & 8.3k                    & Multi-Framework       & Yes               & 2.11.2           & \url{https://onsen.io/}                                                          \\ \hline
		Primefaces (Angular)    & 1.3k                    & Multi-Framework       & Yes               & 11.3.2-SNAPSHOT  & \url{https://www.primefaces.org/primeng/}                                        \\ \hline
		Primefaces (React)      & 1.3k                    & Multi-Framework       & Yes               & 6.2.2-SNAPSHOT   & \url{https://www.primefaces.org/primereact/}                                     \\ \hline
		Primefaces (Vue)        & 1.1k                    & Multi-Framework       & Yes               & 3.3.6-SNAPSHOT   & \url{https://www.primefaces.org/primevue/}                                       \\ \hline
		Syncfusion              & unknown (not on github) & Multi-Framework       & No (paid)         & 1.0.0            & \url{https://www.syncfusion.com/}
	\end{tabularx}
	\caption{Collected UI libraries, the number of github stars and whether they were included in the study}
	\label{tab:design:ui-libraries}
\end{table*}
